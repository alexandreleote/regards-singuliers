{% extends 'base.html.twig' %}

{% block title %}Mes Réservations{% endblock %}

{% block stylesheets %}
{{ parent() }}
<link rel="stylesheet" href="{{ asset('css/profile.css') }}">
{% endblock %}

{% block body %}
<section class="profile-container">
    <article class="profile-content">
        <a href="{{ path('profile') }}" class="back-link">
            <i class="fas fa-arrow-left"></i>
            Retour
        </a>
        <section class="card animate-fade-in">
            <div class="profile-header">
                <h1>Mes Réservations</h1>
                <p class="profile-subtitle">Consultez et gérez vos rendez-vous</p>
            </div>

            {# Calendrier Calendly #}
            <div class="reservation-section">
                <h2 class="section-title">
                    <i class="fas fa-calendar-plus"></i>
                    Prendre un rendez-vous
                </h2>
                <div id="calendly-container" 
                     data-url="{{ calendly_url }}"
                     class="calendly-container">
                </div>
                <div id="error-message" class="alert alert-danger" style="display: none;"></div>
            </div>

            {# Réservations actuelles #}
            <div class="reservation-section">
                <h2 class="section-title">
                    <i class="fas fa-clock"></i>
                    Votre rendez-vous du jour
                </h2>
                {% set todayReservations = reservations|filter(r => r.appointmentDatetime|date('Y-m-d') == "now"|date('Y-m-d')) %}
                {% if todayReservations is not empty %}
                    {% for reservation in todayReservations %}
                        <div class="reservation-card">
                            <div class="reservation-info">
                                <h3>{{ reservation.service.title }}</h3>
                                <p>{{ reservation.appointmentDatetime|date('H:i') }}</p>
                                <span class="status-badge status-{{ reservation.status }}">
                                    {{ reservation.status }}
                                </span>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p>Vous n'avez pas de rendez-vous aujourd'hui.</p>
                {% endif %}
            </div>

            {# Réservations à venir #}
            <div class="reservation-section">
                <h2 class="section-title">
                    <i class="fas fa-calendar-alt"></i>
                    Réservations à venir
                </h2>
                {% set upcomingReservations = reservations|filter(r => r.appointmentDatetime|date('Y-m-d') > "now"|date('Y-m-d')) %}
                {% if upcomingReservations is not empty %}
                    {% for reservation in upcomingReservations %}
                        <div class="reservation-card">
                            <div class="reservation-info">
                                <h3>{{ reservation.service.title }}</h3>
                                <p>{{ reservation.appointmentDatetime|date('d/m/Y à H:i') }}</p>
                                <span class="status-badge status-{{ reservation.status }}">
                                    {{ reservation.status }}
                                </span>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p>Vous n'avez pas de réservations à venir.</p>
                {% endif %}
            </div>

            {# Réservations passées #}
            <div class="reservation-section">
                <h2 class="section-title">
                    <i class="fas fa-history"></i>
                    Réservations passées
                </h2>
                {% set pastReservations = reservations|filter(r => r.appointmentDatetime|date('Y-m-d') < "now"|date('Y-m-d')) %}
                {% if pastReservations is not empty %}
                    {% for reservation in pastReservations %}
                        <div class="reservation-card">
                            <div class="reservation-info">
                                <h3>{{ reservation.service.title }}</h3>
                                <p>{{ reservation.appointmentDatetime|date('d/m/Y à H:i') }}</p>
                                <span class="status-badge status-{{ reservation.status }}">
                                    {{ reservation.status }}
                                </span>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p>Vous n'avez pas de réservations passées.</p>
                {% endif %}
            </div>
        </section>
    </article>
</section>
{% endblock %}