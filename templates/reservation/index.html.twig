{% extends 'base.html.twig' %}

{% block title %}Réservation - {{ parent() }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">
    {{ encore_entry_link_tags('reservation_styles') }}
    <meta name="stripe-public-key" content="{{ stripe_public_key }}">
    <meta name="user-email" content="{{ app.user.email }}">
{% endblock %}

{% block body %}
    <div class="container mt-5">
        <h1 class="mb-4">Réserver une consultation</h1>

        {# Étape 1: Sélection du service #}
        <div id="services-section">
            <h2 class="mb-3">1. Choisissez votre service</h2>
            <div class="row">
                {% for service in services %}
                    <div class="col-md-6">
                        <div class="service-card" data-service-id="{{ service.id }}">
                            <h3>{{ service.title }}</h3>
                            <p>{{ service.description }}</p>
                            <p><strong>Prix:</strong> {{ service.price }}€</p>
                            <p><strong>Durée:</strong> {{ service.duration }} minutes</p>
                            <button class="btn btn-primary select-service">Sélectionner</button>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>

        {# Étape 2: Calendrier Calendly #}
        <div id="calendar-section" style="display: none;">
            <h2 class="mb-3">2. Choisissez une date</h2>
            <div id="calendar-container"></div>
        </div>

        {# Étape 3: Paiement Stripe #}
        <div id="payment-section" style="display: none;">
            <h2 class="mb-3">3. Paiement de l'acompte</h2>
            <div id="payment-form">
                <p class="mb-3">Un acompte de 30% est requis pour confirmer votre réservation.</p>
                <div id="card-element"></div>
                <button id="submit-payment" class="btn btn-success btn-block">
                    Payer l'acompte et confirmer la réservation
                </button>
                <div id="payment-message" class="mt-3"></div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('reservation') }}
{% endblock %}
